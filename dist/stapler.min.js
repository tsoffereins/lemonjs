var Stapler=function(){function e(e,n,r){return a(e)&&(r=n,n=e,e="$stapler"),t(n,e),new f(r,e)}function t(e,t){function a(e){for(var n,r,o=[],a=e.textContent;n=f.exec(e.textContent);)!function(e){var n=e[1],r=e[2],i=u(t,r);a=a.replace(n,""),o.push(document.createTextNode(n));var c=document.createTextNode(r);a=a.replace(i,""),o.push(c),new h(i).onChange(function(e){c.textContent=e})}(n),r=!0;r&&(a&&o.push(document.createTextNode(a)),o.reverse().forEach(function(t){e.after(t)}),e.remove())}function i(e){for(var o=0;o<e.attributes.length;o++)for(var a=e.attributes[o];match=f.exec(a.nodeValue);){var i=new h(u(t,match[2]));if(i.onChange(n.bind(null,a)),window.foobar=a,"value"===a.nodeName&&"INPUT"===e.tagName){var c="change";switch(e.type){case"text":case"email":case"password":c="keyup"}e.addEventListener(c,r.bind(null,i,e))}}}var f=new RegExp("(.*?)"+o(t)+".([a-zA-Z0-9_.]+)","g");e.querySelectorAll(":not(script)").forEach(function(e){c(e).forEach(a),i(e)})}function n(e,t){e.nodeValue=t}function r(e,t){e.change(t.value)}function o(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function a(e){return"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function c(e){return Array.prototype.filter.call(e.childNodes,function(e){return 3===e.nodeType&&!e.textContent.match(/^[\s]*$/)})}function u(){var e=Array.prototype.join.call(arguments,".");if(!/^[a-zA-Z0-9_\.\$]+$/.test(e))throw new Error(e+" is not a valid identifier");return e}var f=function(e,t){function n(n){var o=e[n.name];Object.defineProperty(e,n.name,{get:function(){return r[n.name]},set:function(e){a(e)&&(e=new f(e,u(t,n.name))),r[n.name]=e,n.change(i(e)?e():e)}}),e[n.name]=o}var r={};return new h(t).getChildWatchers().forEach(n),e},h=function(){function e(e,t){t=a(t)?t[this.name]:void 0,e(t)}var t={},n=function(e){if(t[e])return t[e];t[e]=this;var r=e.split(".");this.key=e,this.name=r.pop(),this.listeners=[],r.length>0&&(this.parentWatcher=new n(r.join(".")))};return n.prototype.onChange=function(t){this.listeners.push(t),this.parentWatcher&&this.parentWatcher.onChange(e.bind(null,t))},n.prototype.change=function(e){this.listeners.forEach(function(t){t(e)})},n.prototype.getChildWatchers=function(){var e=new RegExp("^"+o(this.key)+"\\.[a-zA-Z0-9_]+$"),n=[];for(var r in t)e.test(r)&&n.push(t[r]);return n},n}();return e}();