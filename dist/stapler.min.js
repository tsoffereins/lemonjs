var Stapler=function(){function e(e,n,r){return o(e)&&(r=n,n=e,e="$stapler"),t(n,e),new u(r,e)}function t(e,t){function o(e){for(var n,r,a=[],o=e.textContent;n=h.exec(e.textContent);)!function(e){var n=e[1],r=e[2],i=c(t,r);o=o.replace(n,""),a.push(document.createTextNode(n));var u=document.createTextNode(r);o=o.replace(i,""),a.push(u),new f(i).onChange(function(e){u.textContent=e})}(n),r=!0;r&&(o&&a.push(document.createTextNode(o)),a.reverse().forEach(function(t){e.after(t)}),e.remove())}function u(e){for(var a=0;a<e.attributes.length;a++)for(var o=e.attributes[a];match=h.exec(o.nodeValue);){var i=new f(c(t,match[2]));if(i.onChange(n.bind(null,o)),window.foobar=o,"value"===o.nodeName&&"INPUT"===e.tagName){var u="change";switch(e.type){case"text":case"email":case"password":u="keyup"}e.addEventListener(u,r.bind(null,i,e))}}}var h=new RegExp("(.*?)"+a(t)+".([a-zA-Z0-9_.]+)","g");e.querySelectorAll(":not(script)").forEach(function(e){i(e).forEach(o),u(e)})}function n(e,t){e.nodeValue=t}function r(e,t){e.change(t.value)}function a(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function o(e){return"object"==typeof e&&null!==e}function i(e){return Array.prototype.filter.call(e.childNodes,function(e){return 3===e.nodeType&&!e.textContent.match(/^[\s]*$/)})}function c(){var e=Array.prototype.join.call(arguments,".");if(!/^[a-zA-Z0-9_\.\$]+$/.test(e))throw new Error(e+" is not a valid identifier");return e}var u=function(e,t){function n(n){var a=e[n.name];Object.defineProperty(e,n.name,{get:function(){return r[n.name]},set:function(e){o(e)&&(e=new u(e,c(t,n.name))),r[n.name]=e,n.change(e)}}),e[n.name]=a}var r={};return new f(t).getChildWatchers().forEach(n),e},f=function(){function e(e,t){t=o(t)?t[this.name]:void 0,e(t)}var t={},n=function(e){if(t[e])return t[e];t[e]=this;var r=e.split(".");this.key=e,this.name=r.pop(),this.listeners=[],r.length>0&&(this.parentWatcher=new n(r.join(".")))};return n.prototype.onChange=function(t){this.listeners.push(t),this.parentWatcher&&this.parentWatcher.onChange(e.bind(null,t))},n.prototype.change=function(e){this.listeners.forEach(function(t){t(e)})},n.prototype.getChildWatchers=function(){var e=new RegExp("^"+a(this.key)+"\\.[a-zA-Z0-9_]+$"),n=[];for(var r in t)e.test(r)&&n.push(t[r]);return n},n}();return e}();