var Lemon=function(){function e(e,t,r){return a(e)&&(r=t,t=e,e="$lemon"),n(t,e),new u(r,e)}function n(e,n){function a(e){for(var t,r,o=[],a=e.textContent;t=h.exec(e.textContent);)!function(e){var t=e[1],r=e[2],i=c(n,r);a=a.replace(t,""),o.push(document.createTextNode(t));var u=document.createTextNode(r);a=a.replace(i,""),o.push(u),new f(i).onChange(function(e){u.textContent=e})}(t),r=!0;r&&(a&&o.push(document.createTextNode(a)),o.reverse().forEach(function(n){e.after(n)}),e.remove())}function u(e){for(var o=0;o<e.attributes.length;o++)for(var a=e.attributes[o];match=h.exec(a.nodeValue);){var i=new f(c(n,match[2]));if(i.onChange(t.bind(null,a)),window.foobar=a,"value"===a.nodeName&&"INPUT"===e.tagName){var u="change";switch(e.type){case"text":case"email":case"password":u="keyup"}e.addEventListener(u,r.bind(null,i,e))}}}var h=new RegExp("(.*?)"+o(n)+".([a-zA-Z0-9_.]+)","g");e.querySelectorAll(":not(script)").forEach(function(e){i(e).forEach(a),u(e)})}function t(e,n){e.nodeValue=n}function r(e,n){e.change(n.value)}function o(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function a(e){return"object"==typeof e&&null!==e}function i(e){return Array.prototype.filter.call(e.childNodes,function(e){return 3===e.nodeType&&!e.textContent.match(/^[\s]*$/)})}function c(){var e=Array.prototype.join.call(arguments,".");if(!/^[a-zA-Z0-9_\.\$]+$/.test(e))throw new Error(e+" is not a valid identifier");return e}var u=function(e,n){function t(t){var o=e[t.name];Object.defineProperty(e,t.name,{get:function(){return r[t.name]},set:function(e){a(e)&&(e=new u(e,c(n,t.name))),r[t.name]=e,t.change(e)}}),e[t.name]=o}var r={};return new f(n).getChildWatchers().forEach(t),e},f=function(){function e(e,n){n=a(n)?n[this.name]:void 0,e(n)}var n={},t=function(e){if(n[e])return n[e];n[e]=this;var r=e.split(".");this.key=e,this.name=r.pop(),this.listeners=[],r.length>0&&(this.parentWatcher=new t(r.join(".")))};return t.prototype.onChange=function(n){this.listeners.push(n),this.parentWatcher&&this.parentWatcher.onChange(e.bind(null,n))},t.prototype.change=function(e){this.listeners.forEach(function(n){n(e)})},t.prototype.getChildWatchers=function(){var e=new RegExp("^"+o(this.key)+"\\.[a-zA-Z0-9_]+$"),t=[];for(var r in n)e.test(r)&&t.push(n[r]);return t},t}();return e}();